# ==============================================================================
# Static Tier â€” Frontend (Nginx Reverse Proxy + SPA)
# ==============================================================================
# Machine D (or CDN): Serves the admin SPA and proxies to remote services
#
# Usage:
#   docker-compose -f docker-compose.static-tier.yml --env-file .env.distributed up -d
#
# NOTE: Requires nginx.conf.template (envsubst at container start)
# ==============================================================================

services:
  frontend:
    build:
      context: ../
      dockerfile: Dockerfile.frontend
      args:
        VITE_API_URL: ""
    ports:
      - "${FRONTEND_PORT:-80}:80"
    environment:
      # These are substituted into nginx.conf.template at container start
      - BACKEND_HOST=${BACKEND_HOST:-backend}
      - BACKEND_PORT=${BACKEND_PORT:-8000}
      - EDGE_HOST=${EDGE_HOST:-edge}
      - EDGE_PORT=${EDGE_PORT:-3002}
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://127.0.0.1:80/nginx-health" ]
      interval: 15s
      timeout: 5s
      retries: 3
      start_period: 30s
